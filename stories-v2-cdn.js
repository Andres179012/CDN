class t extends HTMLElement{_formatTimeAgo(t){if(!t)return"";const i=new Date-new Date(t),e=Math.floor(i/1e3),n=Math.floor(e/60),s=Math.floor(n/60),r=Math.floor(s/24);return r>0?1===r?"1 day ago":`${r} days ago`:s>0?1===s?"1 hour ago":`${s} hours ago`:n>0?1===n?"1 min ago":`${n} mins ago`:"Just now"}constructor(){super(),this.attachShadow({mode:"open"}),this.histories=[],this.groups=[],this.widgetId="",this._paused=!1,this._activeGroupIdx=void 0,this.size=68,this.distribution="center"}static get observedAttributes(){return["widgetid","size","distribution"]}attributeChangedCallback(t,i,e){if("widgetid"===t&&e&&e!==i&&(this.widgetId=e,this.fetchHistories()),"size"===t&&e&&e!==i){const t=parseInt(e,10);this.size=isNaN(t)?68:t,this.render()}"distribution"===t&&e&&e!==i&&(this.distribution="start"===e?"start":"center",this.render())}connectedCallback(){if(this.getAttribute("widgetid")&&(this.widgetId=this.getAttribute("widgetid"),this.fetchHistories()),this.getAttribute("size")){const t=parseInt(this.getAttribute("size"),10);this.size=isNaN(t)?68:t}this.getAttribute("distribution")&&(this.distribution="start"===this.getAttribute("distribution")?"start":"center")}async fetchHistories(){if(this.widgetId)try{const t=await fetch(`https://horizondesk-api-0a74dafcd4fb.herokuapp.com/api/histories/by-client/${this.widgetId}`);if(!t.ok)throw new Error("Error al obtener grupos de historias");const i=await t.json();console.log("Fetched groups:",i),this.groups=Array.isArray(i)?i:[],this.histories=[],this._activeGroupIdx=void 0,this._activeStoryIdx=void 0,this.render()}catch(t){this.groups=[],this.histories=[],this._activeGroupIdx=void 0,this._activeStoryIdx=void 0,this.render()}}render(){this._binded||(this.shadowRoot.addEventListener("click",(i=>{if(i.target.closest(".hw-gauss-left"))return void this.navigateStory("prev");if(i.target.closest(".hw-gauss-right"))return void this.navigateStory("next");if(i.target.classList.contains("hw-touch-left")){return void(this.groups[this._activeGroupIdx]&&this._activeStoryIdx>0&&this.openStory(this._activeStoryIdx-1,this._activeGroupIdx))}if(i.target.classList.contains("hw-touch-right")){const t=this.groups[this._activeGroupIdx];return void(t&&this._activeStoryIdx<t.stories.length-1&&this.openStory(this._activeStoryIdx+1,this._activeGroupIdx))}if(i.target.classList.contains("hw-pause")){this._paused=!this._paused,this._paused?(this._pauseTime=Date.now(),this._progressRAF&&(cancelAnimationFrame(this._progressRAF),this._progressRAF=null)):(this._pauseTime&&(this._elapsedPaused=(this._elapsedPaused||0)+(Date.now()-this._pauseTime),this._pauseTime=null),this._progressRAF||this._startProgressBarMulti(t,this._activeStoryIdx));const i=this.shadowRoot.querySelector(".hw-pause");return void(i&&(i.setAttribute("data-paused",this._paused?"true":"false"),i.innerHTML=this._paused?"&#9654;":"&#10073;&#10073;"))}if(i.target.classList.contains("hw-overlay"))return void this.closeStory();if(i.target.classList.contains("hw-story-img")){const t=this.groups[this._activeGroupIdx];return void(t&&t.stories&&this._activeStoryIdx<t.stories.length-1?this.openStory(this._activeStoryIdx+1,this._activeGroupIdx):this.closeStory())}if(i.target.classList.contains("hw-group-nav-btn")){const t=i.target.getAttribute("data-dir");return void this.navigateGroup(t)}i.target.classList.contains("hw-close")&&this.closeStory();let e=i.target.closest(".hw-circle[data-group-idx]");if(e){const t=Number(e.getAttribute("data-group-idx"));this.openStory(0,t)}if(i.target.classList.contains("hw-arrow")){const t=i.target.getAttribute("data-dir");this.navigateStory(t)}})),this._binded=!0);const t=4e3,i=this._activeStoryIdx;"number"==typeof i&&(this.histories&&this.histories.flatStories?this.histories.flatStories[i]:this.histories[i]);const e=this.histories&&this.histories.flatStories?this.histories.flatStories:this.histories;"number"==typeof i&&i>0&&e[i-1],"number"==typeof i&&i<e.length-1&&e[i+1];let n="";n=Array.isArray(this.groups)&&this.groups.length>0?`<div class="hw-list" style="--hw-circle-size:${this.size}px; justify-content:${this.distribution};">${this.groups.map(((t,i)=>t.stories&&t.stories.length>0?`<div style="display:flex;flex-direction:column;align-items:center;">\n                  <div class="hw-circle" data-group-idx="${i}" title="${t.groupTitle||""}">\n                    <img src="${t.stories[0].photoUrl}" alt="Preview" />\n                  </div>\n                  <div class="hw-group-title hw-group-title-small" title="${t.groupTitle}">${t.groupTitle&&t.groupTitle.length>10?t.groupTitle.slice(0,10)+"…":t.groupTitle||""}</div>\n                </div>`:"")).join("")}</div>`:"",this.shadowRoot.innerHTML=`\n      <style>\n        .hw-group { margin-bottom: 18px; }\n        .hw-group-title {\n          font-size: 1.08em;\n          font-weight: bold;\n          color: #1B48D2;\n          margin-bottom: 6px;\n          text-align: left;\n          max-width: 90vw;\n          white-space: nowrap;\n          overflow: hidden;\n          text-overflow: ellipsis;\n        }\n        .hw-group-title-small {\n          font-size: 0.78em;\n          color: #111;\n          font-weight: normal;\n        }\n        .hw-list {\n          display: flex;\n          gap: 18px;\n          padding: 18px;\n          overflow-x: auto;\n          justify-content: center;\n          scroll-padding-left: 18px;\n        }\n        @media (max-width: 600px) {\n          .hw-list {\n            justify-content: flex-start;\n          }\n          #hw-group-nav-btn-prev {\n            left: 3% !important;\n          }\n          #hw-group-nav-btn-next {\n            right: 3% !important;\n          }\n        }\n        .hw-circle {\n          width: var(--hw-circle-size, 68px);\n          height: var(--hw-circle-size, 68px);\n          border-radius: 50%;\n          border: 3px solid transparent;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          background: linear-gradient(135deg, #339EDF, #1B48D2);\n          cursor: pointer;\n          box-shadow: 0 2px 8px rgba(0,0,0,0.08);\n          position: relative;\n          transition: transform 0.1s;\n        }\n        .hw-circle img {\n          width: calc(var(--hw-circle-size, 68px) - 8px);\n          height: calc(var(--hw-circle-size, 68px) - 8px);\n          border-radius: 50%;\n          object-fit: cover;\n          border: 2.5px solid #fff;\n        }\n        .hw-desc {\n          text-align: center;\n          font-size: 0.85em;\n          margin-top: 6px;\n          color: #444;\n          max-width: 70px;\n          white-space: nowrap;\n          overflow: hidden;\n          text-overflow: ellipsis;\n        }\n        .hw-overlay {\n          position: fixed;\n          top: 0; left: 0; right: 0; bottom: 0;\n          background: rgba(0,0,0,0.85);\n          z-index: 9999;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          flex-direction: column;\n          animation: fadeIn 0.2s;\n          cursor: pointer;\n        }\n        .hw-overlay-center {\n          width: 60vw;\n          max-width: 600px;\n          min-width: 320px;\n          height: 100vh;\n          min-height: 320px;\n          max-height: 100vh;\n          display: flex;\n          flex-direction: column;\n          align-items: center;\n          justify-content: flex-start;\n          background: transparent;\n          position: relative;\n          overflow: hidden;\n          transition: background-image 0.3s cubic-bezier(.4,0,.2,1);\n          --hw-bg-img: none;\n        }\n        .hw-overlay-center::before {\n          content: '';\n          position: absolute;\n          inset: 0;\n          z-index: 0;\n          background-image: var(--hw-bg-img, none);\n          background-size: cover;\n          background-position: center;\n          filter: blur(32px) brightness(0.5) saturate(1.1);\n          opacity: 1;\n          pointer-events: none;\n          transition: background-image 0.3s cubic-bezier(.4,0,.2,1), filter 0.2s;\n        }\n        .hw-gauss-left, .hw-gauss-right {\n          position: fixed;\n          top: 50%;\n          transform: translateY(-50%);\n          width: 170px; /* Más ancho */\n          height: 45%;\n          max-width: 32vw; /* Más ancho */\n          z-index: 10001;\n          opacity: 0.55;\n          filter: blur(2.5px) grayscale(0.2) brightness(0.7);\n          pointer-events: auto;\n          transition: opacity 0.2s;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n        }\n        .hw-gauss-left {\n          left: calc(50vw - 300px - 170px - 32px); /* Separado más: 170px (mitad del nuevo ancho) + 32px de margen extra */\n        }\n        .hw-gauss-right {\n          right: calc(50vw - 300px - 170px - 32px);\n        }\n        .hw-gauss-img {\n          width: 100%;\n          height: 100%;\n          object-fit: cover;\n          border-radius: 18px;\n          box-shadow: 0 2px 16px 0 #0008;\n          opacity: 0.85;\n        }\n        .hw-overlay-center::before {\n          content: '';\n          position: absolute;\n          inset: 0;\n          z-index: 0;\n          background-image: var(--hw-bg-img, none);\n          background-size: cover;\n          background-position: center;\n          filter: blur(32px) brightness(0.7);\n          opacity: 1;\n          pointer-events: none;\n          transition: background-image 0.3s cubic-bezier(.4,0,.2,1), filter 0.2s;\n        }\n        .hw-overlay-center > *:not(.hw-gauss-left):not(.hw-gauss-right) {\n          position: relative;\n          z-index: 1;\n        }\n        .hw-progress-bar-multi {\n          width: 100%;\n          height: 5px;\n          display: flex;\n          gap: 4px;\n          z-index: 10002;\n          padding: 0 8px;\n          margin: 0 auto;\n          position: sticky;\n          top: 0;\n          background: transparent;\n        }\n        .hw-story-center {\n          flex: 1 1 0;\n          display: flex;\n          flex-direction: column;\n          align-items: center;\n          justify-content: center;\n          width: 100%;\n        }\n        .hw-story-img {\n          width: 100%;\n          height: 100%;\n          max-width: 100%;\n          max-height: 80vh;\n          object-fit: contain;\n          display: block;\n          margin: 0 auto;\n        }\n        .hw-story-desc {\n          margin-top: 12px;\n          color: #fff;\n          text-align: center;\n          font-size: 1.1em;\n          /* text-shadow: 0 2px 8px #000; */\n        }\n        .hw-story-time {\n          color: #ffe082;\n          font-size: 0.95em;\n          margin-top: 4px;\n          text-align: center;\n          background: #222a;\n          border-radius: 8px;\n          padding: 2px 10px;\n          display: inline-block;\n        }\n\n        .hw-arrow {\n          position: absolute;\n          top: 50%;\n          transform: translateY(-50%);\n          background: rgba(0,0,0,0.45);\n          border: none;\n          color: #fff;\n          font-size: 2.5em;\n          width: 48px;\n          height: 48px;\n          border-radius: 50%;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          z-index: 10030;\n          cursor: pointer;\n          transition: background 0.2s, color 0.2s, box-shadow 0.2s;\n          box-shadow: 0 2px 8px #0006;\n          opacity: 0.85;\n        }\n        .hw-arrow.left {\n          left: 12px;\n        }\n        .hw-arrow.right {\n          right: 12px;\n        }\n        .hw-arrow:hover {\n          background: #1B48D2;\n          color: #ffe082;\n          opacity: 1;\n        }\n\n        .hw-progress-multi {\n          flex: 1 1 0;\n          height: 100%;\n          background: #e0e0e0;\n          border-radius: 3px;\n          overflow: hidden;\n          position: relative;\n        }\n        .hw-progress-multi-inner {\n          height: 100%;\n          background: #fff;\n          width: 0%;\n          transition: width 0.1s linear;\n        }\n        .hw-close {\n          position: fixed;\n          top: 32px;\n          right: 48px;\n          left: auto;\n          transform: none;\n          font-size: 2.2em;\n          color: #fff;\n          background: none;\n          border: none;\n          border-radius: 0;\n          width: 48px;\n          height: 48px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          box-shadow: none;\n          cursor: pointer;\n          z-index: 10010;\n          transition: color 0.2s;\n        }\n        .hw-close:hover {\n          color: #ffe082;\n          background: none;\n          box-shadow: none;\n        }\n        .hw-pause {\n          position: absolute;\n          left: 50%;\n          bottom: 12px;\n          transform: translateX(-50%);\n          font-size: 1.3em;\n          color: #fff;\n          background: none;\n          border: none;\n          border-radius: 50%;\n          width: 36px;\n          height: 36px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          box-shadow: none;\n          cursor: pointer;\n          z-index: 10020;\n          transition: color 0.2s;\n        }\n        .hw-pause:hover {\n          color: #ffe082;\n          background: none;\n        }\n        .hw-touch-nav {\n          position: absolute;\n          top: 0;\n          width: 50%;\n          height: 100%;\n          z-index: 10;\n          cursor: pointer;\n          background: transparent;\n        }\n        .hw-touch-left {\n          left: 0;\n        }\n        .hw-touch-right {\n          right: 0;\n        }\n        @keyframes fadeIn {\n          from { opacity: 0; }\n          to { opacity: 1; }\n        }\n        @media (max-width: 900px) {\n          .hw-overlay-center {\n            width: 90vw;\n            min-width: 0;\n            max-width: 98vw;\n          }\n          .hw-gauss-left, .hw-gauss-right {\n            width: 110px; /* Más ancho */\n            max-width: 26vw; /* Más ancho */\n            height: 45%;\n          }\n          .hw-gauss-left {\n            left: calc(50vw - 0.45 * 90vw - 110px - 24px); /* Separado más */\n          }\n          .hw-gauss-right {\n            right: calc(50vw - 0.45 * 90vw - 110px - 24px);\n          }\n        }\n        @media (max-width: 600px) {\n          .hw-overlay-center {\n            width: 100vw;\n            min-width: 0;\n            max-width: 100vw;\n            height: 100vh;\n            max-height: 100vh;\n            border-radius: 0;\n          }\n          .hw-story-img { max-width: 98vw; max-height: 55vh; }\n          .hw-close { right: 10px; top: 10px; }\n          .hw-pause { right: 16px; bottom: 16px; top: auto; }\n          .hw-arrow.left { left: 4px; }\n          .hw-arrow.right { right: 4px; }\n          .hw-progress-bar-multi { height: 3px; }\n          .hw-gauss-left, .hw-gauss-right {\n            width: 38px; /* Más ancho */\n            height: 45%;\n          }\n          .hw-gauss-left {\n            left: calc(50vw - 0.5 * 100vw - 38px - 8px); /* Separado más */\n          }\n          .hw-gauss-right {\n            right: calc(50vw - 0.5 * 100vw - 38px - 8px);\n          }\n        }\n        .hw-group-badge {\n          display: inline-block;\n          margin: 10px auto 0 auto;\n          padding: 3px 14px;\n          border-radius: 16px;\n          background: #1B48D2;\n          color: #fff;\n          font-size: 0.98em;\n          font-weight: 600;\n          letter-spacing: 0.02em;\n          box-shadow: 0 2px 8px #0002;\n          text-align: center;\n          min-width: 60px;\n          max-width: 90vw;\n          white-space: nowrap;\n          overflow: hidden;\n          text-overflow: ellipsis;\n        }\n      </style>\n      <div>\n        ${n}\n        ${"number"==typeof this._activeGroupIdx&&this.groups[this._activeGroupIdx]&&this.groups[this._activeGroupIdx].stories&&"number"==typeof this._activeStoryIdx?(()=>{const t=this.groups[this._activeGroupIdx],i=t.stories,e=i[this._activeStoryIdx],n=this._activeStoryIdx>0?i[this._activeStoryIdx-1]:null;let s=null;this._activeGroupIdx<this.groups.length-1&&this.groups[this._activeGroupIdx+1].stories&&this.groups[this._activeGroupIdx+1].stories.length>0&&(s=this.groups[this._activeGroupIdx+1].stories[0]);return`\n  <button class="hw-close" title="Close">&times;</button>\n  <div class="hw-overlay">\n  ${this._activeGroupIdx>0?'<button class="hw-group-nav-btn" id="hw-group-nav-btn-prev" style="position:fixed;left:35%;top:50%;transform:translateY(-50%);z-index:10050;background:#fff;color:#111;border:none;border-radius:50%;width:36px;height:36px;font-size:1.3em;box-shadow:0 2px 8px #0003;cursor:pointer;opacity:0.92;display:flex;align-items:center;justify-content:center;" data-dir="prev" title="Previous group">&#10229;</button>':""}\n  ${this._activeGroupIdx<this.groups.length-1?'<button class="hw-group-nav-btn" id="hw-group-nav-btn-next" style="position:fixed;right:35%;top:50%;transform:translateY(-50%);z-index:10050;background:#fff;color:#111;border:none;border-radius:50%;width:36px;height:36px;font-size:1.3em;box-shadow:0 2px 8px #0003;cursor:pointer;opacity:0.92;display:flex;align-items:center;justify-content:center;" data-dir="next" title="Next group">&#10230;</button>':""}\n  ${n?`<div class="hw-gauss-left hw-gauss" title="Previous"><img class="hw-gauss-img" src="${n.photoUrl}" alt="Previous" /></div>`:""}\n  ${s?`<div class="hw-gauss-right hw-gauss" title="Next"><img class="hw-gauss-img" src="${s.photoUrl}" alt="Next" /></div>`:""}\n    <div class="hw-overlay-center" style="--hw-bg-img:url('${e.photoUrl}');">\n      <div class="hw-progress-bar-multi">\n        ${i.map(((t,i)=>`<div class="hw-progress-multi"><div class="hw-progress-multi-inner" data-bar-idx="${i}"></div></div>`)).join("")}\n      </div>\n      <div class="hw-group-badge">${t.groupTitle||""}</div>\n      <div class="hw-story-center" style="position:relative;">\n        <img class="hw-story-img" src="${e.photoUrl}" alt="Historia" onload="this.classList.add('hw-img-loaded')" />\n        \x3c!-- Overlays para navegación táctil/click izquierda/derecha solo historias internas del grupo --\x3e\n        <div class="hw-touch-nav hw-touch-left"></div>\n        <div class="hw-touch-nav hw-touch-right"></div>\n        <div class="hw-story-desc">${e.description||""}</div>\n        <div class="hw-story-desc">${e.storyTitle||t.groupTitle||""}</div>\n        <div class="hw-story-time" style="color:#ffe082; font-size:0.95em; margin-top:4px; text-align:center;">${this._formatTimeAgo(e.fechaCreacion)}</div>\n        <button class="hw-pause" title="Pause/Resume" data-paused="${this._paused?"true":"false"}">${this._paused?"&#9654;":"&#10073;&#10073;"}</button>\n      </div>\n    </div>\n  </div>\n                `})():""}\n      </div>\n    `,"number"==typeof this._activeGroupIdx&&this.groups[this._activeGroupIdx]&&"number"==typeof this._activeStoryIdx?(this._elapsedPaused=0,this._startProgressBarMulti(t,this._activeStoryIdx,this.groups[this._activeGroupIdx].stories.length)):this._stopProgressBar();const s=this.shadowRoot.querySelector(".hw-list");s&&(s.scrollLeft=0)}navigateGroup(t){"number"==typeof this._activeGroupIdx&&("prev"===t&&this._activeGroupIdx>0?this.openStory(0,this._activeGroupIdx-1):"next"===t&&this._activeGroupIdx<this.groups.length-1&&this.openStory(0,this._activeGroupIdx+1))}_startProgressBarMulti(t,i){this._progressRAF&&(cancelAnimationFrame(this._progressRAF),this._progressRAF=null),this._progressStart=this._progressStart||Date.now();const e=Array.from(this.shadowRoot.querySelectorAll(".hw-progress-multi-inner")),n=()=>{if("number"!=typeof this._activeStoryIdx)return;if(this._paused)return void(this._progressRAF=null);const s=Date.now(),r=this._elapsedPaused||0,o=s-this._progressStart-r;let a=Math.min(1,o/t);e.forEach(((t,e)=>{t.style.width=e<i?"100%":e===i?100*a+"%":"0%"}));const h="number"==typeof this._activeGroupIdx?this.groups[this._activeGroupIdx]:null,d=h&&h.stories?h.stories:[];o>=t?(this._progressRAF=null,this._elapsedPaused=0,this._pauseTime=null,d.length>1&&this._activeStoryIdx<d.length-1?(this._activeStoryIdx++,this._progressStart=Date.now(),this.render()):this.closeStory()):this._progressRAF=requestAnimationFrame(n)};this._progressRAF=requestAnimationFrame(n)}_stopProgressBar(){this._progressRAF&&(cancelAnimationFrame(this._progressRAF),this._progressRAF=null),this._progressStart=null}openStory(t,i){"number"==typeof i&&(this._activeGroupIdx=i),this._activeStoryIdx=t,this._progressStart=Date.now(),this._elapsedPaused=0,this._pauseTime=null,this._progressRAF&&(cancelAnimationFrame(this._progressRAF),this._progressRAF=null);try{const t=this.groups[this._activeGroupIdx];t&&"number"==typeof this._activeStoryIdx&&fetch(`https://horizondesk-api-0a74dafcd4fb.herokuapp.com/api/histories/${t._id||t.id}/view/${this._activeStoryIdx}`,{method:"POST"})}catch(t){}this.render()}closeStory(){this._activeStoryIdx=void 0,this._activeGroupIdx=void 0,this._progressRAF&&(cancelAnimationFrame(this._progressRAF),this._progressRAF=null),this._progressStart=null,this.render()}navigateStory(t){if("number"!=typeof this._activeGroupIdx||"number"!=typeof this._activeStoryIdx)return;const i=this.groups[this._activeGroupIdx],e=i&&i.stories?i.stories:[];"prev"===t&&this._activeStoryIdx>0?this.openStory(this._activeStoryIdx-1,this._activeGroupIdx):"next"===t&&(this._activeGroupIdx<this.groups.length-1&&this.groups[this._activeGroupIdx+1].stories&&this.groups[this._activeGroupIdx+1].stories.length>0?this.openStory(0,this._activeGroupIdx+1):this._activeStoryIdx<e.length-1?this.openStory(this._activeStoryIdx+1,this._activeGroupIdx):this.closeStory())}_togglePause(){this._paused=!this._paused;const t=this.shadowRoot.querySelector(".hw-pause");this._paused?(clearInterval(this._interval),t.setAttribute("data-paused","true"),t.innerHTML="&#9654;"):(this._progressStart=Date.now()-(this._elapsedTime||0),this._startProgressBarMulti(this._duration,this._activeStoryIdx),t.setAttribute("data-paused","false"),t.innerHTML="&#10073;&#10073;")}}customElements.get("histories-widget")||customElements.define("histories-widget",t),customElements.define("histories-widget",t);
//# sourceMappingURL=index.js.map
