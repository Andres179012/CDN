class t extends HTMLElement{_formatTimeAgo(t){if(!t)return"";const n=new Date-new Date(t),e=Math.floor(n/1e3),i=Math.floor(e/60),s=Math.floor(i/60),r=Math.floor(s/24);return r>0?1===r?"1 day ago":`${r} days ago`:s>0?1===s?"1 hour ago":`${s} hours ago`:i>0?1===i?"1 min ago":`${i} mins ago`:"Just now"}constructor(){super(),this.attachShadow({mode:"open"}),this.histories=[],this.widgetId="",this._paused=!1}static get observedAttributes(){return["widgetid"]}attributeChangedCallback(t,n,e){"widgetid"===t&&e&&e!==n&&(this.widgetId=e,this.fetchHistories())}connectedCallback(){this.getAttribute("widgetid")&&(this.widgetId=this.getAttribute("widgetid"),this.fetchHistories())}async fetchHistories(){if(this.widgetId)try{const t=await fetch(`https://horizondesk-api-0a74dafcd4fb.herokuapp.com/api/histories/active/${this.widgetId}`);if(!t.ok)throw new Error("Error al obtener historias");this.histories=await t.json(),this.render()}catch(t){this.histories=[],this.render()}}render(){this._binded||(this.shadowRoot.addEventListener("click",(n=>{if(n.target.closest(".hw-gauss-left"))return void this.navigateStory("prev");if(n.target.closest(".hw-gauss-right"))return void this.navigateStory("next");if(n.target.classList.contains("hw-pause")){this._paused=!this._paused,this._paused?(this._pauseTime=Date.now(),this._progressRAF&&(cancelAnimationFrame(this._progressRAF),this._progressRAF=null)):(this._pauseTime&&(this._elapsedPaused=(this._elapsedPaused||0)+(Date.now()-this._pauseTime),this._pauseTime=null),this._progressRAF||this._startProgressBarMulti(t,this._activeStoryIdx));const n=this.shadowRoot.querySelector(".hw-pause");return void(n&&(n.setAttribute("data-paused",this._paused?"true":"false"),n.innerHTML=this._paused?"&#9654;":"&#10073;&#10073;"))}if(n.target.classList.contains("hw-overlay"))return void this.closeStory();if(n.target.classList.contains("hw-story-img")||n.target.classList.contains("hw-story-desc"))return void(this.histories.length>1?this.navigateStory("next"):this.closeStory());n.target.classList.contains("hw-close")&&this.closeStory();let e=n.target.closest(".hw-circle");if(e){const t=e.getAttribute("data-idx");this.openStory(Number(t))}if(n.target.classList.contains("hw-arrow")){const t=n.target.getAttribute("data-dir");this.navigateStory(t)}})),this._binded=!0);const t=4e3,n=this._activeStoryIdx,e="number"==typeof n?this.histories[n]:null,i="number"==typeof n&&n>0?this.histories[n-1]:null,s="number"==typeof n&&n<this.histories.length-1?this.histories[n+1]:null;this.shadowRoot.innerHTML=`\n      <style>\n        .hw-list {\n          display: flex;\n          gap: 18px;\n          padding: 18px;\n          overflow-x: auto;\n          justify-content: flex-start;\n          scroll-padding-left: 18px;\n        }\n        .hw-circle {\n          width: 68px;\n          height: 68px;\n          border-radius: 50%;\n          border: 3px solid transparent;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          background: linear-gradient(135deg, #339EDF, #1B48D2);\n          cursor: pointer;\n          box-shadow: 0 2px 8px rgba(0,0,0,0.08);\n          position: relative;\n          transition: transform 0.1s;\n        }\n        /* .hw-circle:hover {\n          transform: scale(1.07);\n        } */\n        .hw-circle img {\n          width: 60px;\n          height: 60px;\n          border-radius: 50%;\n          object-fit: cover;\n          border: 2.5px solid #fff;\n        }\n        .hw-desc {\n          text-align: center;\n          font-size: 0.85em;\n          margin-top: 6px;\n          color: #444;\n          max-width: 70px;\n          white-space: nowrap;\n          overflow: hidden;\n          text-overflow: ellipsis;\n        }\n        .hw-overlay {\n          position: fixed;\n          top: 0; left: 0; right: 0; bottom: 0;\n          background: rgba(0,0,0,0.85);\n          z-index: 9999;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          flex-direction: column;\n          animation: fadeIn 0.2s;\n          cursor: pointer;\n        }\n        .hw-overlay-center {\n          width: 60vw;\n          max-width: 600px;\n          min-width: 320px;\n          height: 100vh;\n          min-height: 320px;\n          max-height: 100vh;\n          display: flex;\n          flex-direction: column;\n          align-items: center;\n          justify-content: flex-start;\n          background: transparent;\n          position: relative;\n          overflow: hidden;\n          transition: background-image 0.3s cubic-bezier(.4,0,.2,1);\n        }\n        .hw-gauss-left, .hw-gauss-right {\n          position: fixed;\n          top: 50%;\n          transform: translateY(-50%);\n          width: 170px; /* Más ancho */\n          height: 45%;\n          max-width: 32vw; /* Más ancho */\n          z-index: 10001;\n          opacity: 0.55;\n          filter: blur(2.5px) grayscale(0.2) brightness(0.7);\n          pointer-events: auto;\n          transition: opacity 0.2s;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n        }\n        .hw-gauss-left {\n          left: calc(50vw - 300px - 170px - 32px); /* Separado más: 170px (mitad del nuevo ancho) + 32px de margen extra */\n        }\n        .hw-gauss-right {\n          right: calc(50vw - 300px - 170px - 32px);\n        }\n        .hw-gauss-img {\n          width: 100%;\n          height: 100%;\n          object-fit: cover;\n          border-radius: 18px;\n          box-shadow: 0 2px 16px 0 #0008;\n          opacity: 0.85;\n        }\n        .hw-overlay-center::before {\n          content: '';\n          position: absolute;\n          inset: 0;\n          z-index: 0;\n          background-image: var(--hw-bg-img, none);\n          background-size: cover;\n          background-position: center;\n          filter: blur(32px) brightness(0.7);\n          opacity: 1;\n          pointer-events: none;\n          transition: background-image 0.3s cubic-bezier(.4,0,.2,1), filter 0.2s;\n        }\n        .hw-overlay-center > *:not(.hw-gauss-left):not(.hw-gauss-right) {\n          position: relative;\n          z-index: 1;\n        }\n        .hw-progress-bar-multi {\n          width: 100%;\n          height: 5px;\n          display: flex;\n          gap: 4px;\n          z-index: 10002;\n          padding: 0 8px;\n          margin: 0 auto;\n          position: sticky;\n          top: 0;\n          background: transparent;\n        }\n        .hw-story-center {\n          flex: 1 1 0;\n          display: flex;\n          flex-direction: column;\n          align-items: center;\n          justify-content: center;\n          width: 100%;\n        }\n        .hw-story-img {\n          max-width: 98vw;\n          max-height: 80vh;\n          object-fit: contain;\n          display: block;\n          margin: 0 auto;\n          background: #222;\n        }\n        .hw-story-desc {\n          margin-top: 12px;\n          color: #fff;\n          text-align: center;\n          font-size: 1.1em;\n          text-shadow: 0 2px 8px #000;\n        }\n        .hw-progress-multi {\n          flex: 1 1 0;\n          height: 100%;\n          background: #e0e0e0;\n          border-radius: 3px;\n          overflow: hidden;\n          position: relative;\n        }\n        .hw-progress-multi-inner {\n          height: 100%;\n          background: #fff;\n          width: 0%;\n          transition: width 0.1s linear;\n        }\n        .hw-close {\n          position: fixed;\n          top: 32px;\n          right: 48px;\n          left: auto;\n          transform: none;\n          font-size: 2.2em;\n          color: #fff;\n          background: none;\n          border: none;\n          border-radius: 0;\n          width: 48px;\n          height: 48px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          box-shadow: none;\n          cursor: pointer;\n          z-index: 10010;\n          transition: color 0.2s;\n        }\n        .hw-close:hover {\n          color: #ffe082;\n          background: none;\n          box-shadow: none;\n        }\n        .hw-pause {\n          position: absolute;\n          left: 50%;\n          bottom: 12px;\n          transform: translateX(-50%);\n          font-size: 1.3em;\n          color: #fff;\n          background: none;\n          border: none;\n          border-radius: 50%;\n          width: 36px;\n          height: 36px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          box-shadow: none;\n          cursor: pointer;\n          z-index: 10020;\n          transition: color 0.2s;\n        }\n        .hw-pause:hover {\n          color: #ffe082;\n          background: none;\n        }\n        @keyframes fadeIn {\n          from { opacity: 0; }\n          to { opacity: 1; }\n        }\n        @media (max-width: 900px) {\n          .hw-overlay-center {\n            width: 90vw;\n            min-width: 0;\n            max-width: 98vw;\n          }\n          .hw-gauss-left, .hw-gauss-right {\n            width: 110px; /* Más ancho */\n            max-width: 26vw; /* Más ancho */\n            height: 45%;\n          }\n          .hw-gauss-left {\n            left: calc(50vw - 0.45 * 90vw - 110px - 24px); /* Separado más */\n          }\n          .hw-gauss-right {\n            right: calc(50vw - 0.45 * 90vw - 110px - 24px);\n          }\n        }\n        @media (max-width: 600px) {\n          .hw-overlay-center {\n            width: 100vw;\n            min-width: 0;\n            max-width: 100vw;\n            height: 100vh;\n            max-height: 100vh;\n            border-radius: 0;\n          }\n          .hw-story-img { max-width: 98vw; max-height: 55vh; }\n          .hw-close { right: 10px; top: 10px; }\n          .hw-pause { right: 16px; bottom: 16px; top: auto; }\n          .hw-arrow.left { left: 4px; }\n          .hw-arrow.right { right: 4px; }\n          .hw-progress-bar-multi { height: 3px; }\n          .hw-gauss-left, .hw-gauss-right {\n            width: 38px; /* Más ancho */\n            height: 45%;\n          }\n          .hw-gauss-left {\n            left: calc(50vw - 0.5 * 100vw - 38px - 8px); /* Separado más */\n          }\n          .hw-gauss-right {\n            right: calc(50vw - 0.5 * 100vw - 38px - 8px);\n          }\n        }\n      </style>\n      <div>\n        <div class="hw-list">\n          ${0===this.histories.length?"<p>No hay historias activas.</p>":this.histories.map(((t,n)=>`\n              <div style="display:flex;flex-direction:column;align-items:center;">\n                <div class="hw-circle" data-idx="${n}" title="${t.description||""}">\n                  <img src="${t.photoUrl}" alt="Historia" />\n                </div>\n                <div class="hw-story-time" style="color:#222; font-size:0.80em; margin-top:2px; text-align:center; min-width:60px; font-weight:bold;">${this._formatTimeAgo(t.fechaCreacion)}</div>\n              </div>\n            `)).join("")}\n        </div>\n       ${e?`\n  <button class="hw-close" title="Cerrar">&times;</button>\n  <div class="hw-overlay">\n    ${i?`<div class="hw-gauss-left hw-gauss" title="Anterior"><img class="hw-gauss-img" src="${i.photoUrl}" alt="Anterior" /></div>`:""}\n    ${s?`<div class="hw-gauss-right hw-gauss" title="Siguiente"><img class="hw-gauss-img" src="${s.photoUrl}" alt="Siguiente" /></div>`:""}\n    <div class="hw-overlay-center" style="--hw-bg-img:url('${e.photoUrl}');">\n      <div class="hw-progress-bar-multi">\n        ${this.histories.map(((t,n)=>`\n          <div class="hw-progress-multi"><div class="hw-progress-multi-inner" data-bar-idx="${n}"></div></div>\n        `)).join("")}\n      </div>\n      <div class="hw-story-center">\n        <img class="hw-story-img" src="${e.photoUrl}" alt="Historia" onload="this.classList.add('hw-img-loaded')" />\n        <div class="hw-story-desc">${e.description||""}</div>\n        <div class="hw-story-time" style="color:#ffe082; font-size:0.95em; margin-top:4px; text-align:center;">${this._formatTimeAgo(e.fechaCreacion)}</div>\n        <button class="hw-pause" title="Pausar/Reanudar" data-paused="${this._paused?"true":"false"}">${this._paused?"&#9654;":"&#10073;&#10073;"}</button>\n      </div>\n    </div>\n  </div>\n`:""}\n      </div>\n    `,e?(this._elapsedPaused=0,this._startProgressBarMulti(t,n)):this._stopProgressBar();const r=this.shadowRoot.querySelector(".hw-list");r&&(r.scrollLeft=0)}_startProgressBarMulti(t,n){this._progressRAF&&(cancelAnimationFrame(this._progressRAF),this._progressRAF=null),this._progressStart=this._progressStart||Date.now();const e=Array.from(this.shadowRoot.querySelectorAll(".hw-progress-multi-inner")),i=()=>{if(!this._activeStoryIdx&&0!==this._activeStoryIdx)return;if(this._paused)return void(this._progressRAF=null);const s=Date.now(),r=this._elapsedPaused||0,o=s-this._progressStart-r;let a=Math.min(1,o/t);e.forEach(((t,e)=>{t.style.width=e<n?"100%":e===n?100*a+"%":"0%"})),o>=t?(this._progressRAF=null,this._elapsedPaused=0,this._pauseTime=null,this.histories.length>1&&this._activeStoryIdx<this.histories.length-1?(this._activeStoryIdx++,this._progressStart=Date.now(),this.render()):this.closeStory()):this._progressRAF=requestAnimationFrame(i)};this._progressRAF=requestAnimationFrame(i)}_stopProgressBar(){this._progressRAF&&(cancelAnimationFrame(this._progressRAF),this._progressRAF=null),this._progressStart=null}openStory(t){this._activeStoryIdx=t,this._progressStart=Date.now(),this._elapsedPaused=0,this._pauseTime=null,this._progressRAF&&(cancelAnimationFrame(this._progressRAF),this._progressRAF=null),this.render()}closeStory(){this._activeStoryIdx=void 0,this._progressRAF&&(cancelAnimationFrame(this._progressRAF),this._progressRAF=null),this._progressStart=null,this.render()}navigateStory(t){"number"==typeof this._activeStoryIdx&&("prev"===t&&this._activeStoryIdx>0?this.openStory(this._activeStoryIdx-1):"next"===t&&this._activeStoryIdx<this.histories.length-1?this.openStory(this._activeStoryIdx+1):"next"===t&&this._activeStoryIdx===this.histories.length-1&&this.closeStory())}_togglePause(){this._paused=!this._paused;const t=this.shadowRoot.querySelector(".hw-pause");this._paused?(clearInterval(this._interval),t.setAttribute("data-paused","true"),t.innerHTML="&#9654;"):(this._progressStart=Date.now()-(this._elapsedTime||0),this._startProgressBarMulti(this._duration,this._activeStoryIdx),t.setAttribute("data-paused","false"),t.innerHTML="&#10073;&#10073;")}}customElements.get("histories-widget")||customElements.define("histories-widget",t),customElements.define("histories-widget",t);
//# sourceMappingURL=index.js.map
